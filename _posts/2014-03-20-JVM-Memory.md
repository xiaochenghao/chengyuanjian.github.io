---
layout:         post
title:         JVM内存浅述
description: JVM是Java Virtual Machine（Java虚拟机）的缩写，JVM是一种用于计算设备的规范，它是一个虚构出来的计算机，是通过在实际的计算机上仿真模拟各种计算机功能来实现的。Java虚拟机包括一套字节码指令集、一组寄存器、一个栈、一个垃圾回收堆和一个存储方法域。
keywords: Java, JVM
category: Java
---

JVM是Java Virtual Machine（Java虚拟机）的缩写，JVM是一种用于计算设备的规范，它是一个虚构出来的计算机，是通过在实际的计算机上仿真模拟各种计算机功能来实现的。Java虚拟机内存包括程序计数器、虚拟机栈、本地方法栈、堆、方法区等几个运行时数据区域。


##程序计数器

线程私有，是一块较小的内存空间，可以看做当前线程执行字节码的行号指示器。分支、循环、异常处理、线程恢复等都需要依赖计数器完成。

如果正在执行的是Native方法，计数器值则为空（Undefined），此内存是唯一一个没有任何OutOfMemoryError的情况。

##虚拟机栈

线程私有，生命周期与线程相同。为执行Java方法（字节码）服务；每个方法执行的时候会创建一个栈帧，用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每个方法被调用到执行完成的过程，就对应这一个栈帧在虚拟机栈中入栈到出栈的过程。

如果线程请求的栈深度大于虚拟机所允许的身体，将抛出StackOverflowError异常；如果虚拟机栈可以动态扩展，当扩展时无法申请到足够的内存时会抛出OutOfMemoryError异常。


##本地方法栈

作用与虚拟机栈类似，但为Native方法服务。


##堆

所有线程共享，用于存放对象实例，几乎所有的对象都会在这里分配内存，其大小可以通过-Xmx和-Xms来控制。是GC管理的主要区域。可以处于物理上不连续的内存空间中，但是逻辑上要求连续。当堆中没有内存完成实例分配，并且堆也无法扩展时，将抛出OutOfMemoryError异常。

##方法区

所有线程共享，存储被VM加载的类信息、常量、静态变量等。可以通过-XX:PermSize和-XX:MaxPermSize来指定最小值和最大值。当方法区无法满足内存分配需求的时候，将抛出OutOfMemoryError异常。

##运行时常量池

是方法区的一部分，存放编译期生成的各种字面量和符号引用。

